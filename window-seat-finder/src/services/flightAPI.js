// Convert flight number to OpenSky callsign format
const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay));
const myheaders = new Headers();
//need to add an auth header here    
function formatCallsign(flightNumber) {
  const airlineCodes = {
    'DL': 'DAL',    // Delta
    'UA': 'UAL',    // United  
    'AA': 'AAL',    // American
    'SW': 'SWA',    // Southwest
    'B6': 'JBU',    // JetBlue
    'AS': 'ASA',    // Alaska
  };
  
  const match = flightNumber.match(/([A-Z]{2})(\d+)/);
  if (!match) return flightNumber;
  
  const [, airline, number] = match;
  const openSkyCode = airlineCodes[airline] || airline;
  return `${openSkyCode}${number}`;
}

// Get recent flight by callsign
export async function getRecentFlight(flightNumber) {
  try {
    const callsign = formatCallsign(flightNumber);
    const endTime = Math.floor(Date.now() / 1000);
    const beginTime = endTime - (2 * 60 * 60); // 7 days ago

    const response = await fetch(
      `https://opensky-network.org/api/flights/all?begin=${beginTime}&end=${endTime}`, {myheaders, mode:"cors"}
    );
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const flights = await response.json();
    
    // Find most recent flight with matching callsign
    const matchingFlight = flights
      .filter(flight => flight.callsign && flight.callsign.trim().includes(callsign))
      .sort((a, b) => b.firstSeen - a.firstSeen)[0];
    
    if (!matchingFlight) {
      throw new Error(`No recent flights found for ${flightNumber}`);
    }
    
    return matchingFlight;
    
  } catch (error) {
    console.error('Error fetching flight:', error);
    throw error;
  }
}

// Get flight track data
export async function getFlightTrack(icao24, time) {
  try {
    const response = await fetch(
      `https://opensky-network.org/api/tracks/all?icao24=${icao24}&time=${time}`, {myheaders, mode:"cors"}
    );
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const trackData = await response.json();
    
    if (!trackData.path || trackData.path.length === 0) {
      throw new Error('No track data available for this flight');
    }
    
    // Convert to lat/lon coordinates for the map
    const finalPath = trackData.path
    const coordinates = trackData.path
      .filter(point => point[1] !== null && point[2] !== null) // Filter out null coordinates
      .map(point => [point[1], point[2]]); // [lat, lon]
    
    return {
      coordinates,
      callsign: trackData.callsign,
      startTime: trackData.startTime,
      endTime: trackData.endTime,
      finalPath
    };
    
  } catch (error) {
    console.error('Error fetching track:', error);
    throw error;
  }
}

// Main function to get flight path
export async function getFlightPath(flightNumber) {
  try {
    // Step 1: Find recent flight
    const flight = await getRecentFlight(flightNumber);
    await sleep(1000);
    
    // Step 2: Get track data
    const trackData = await getFlightTrack(flight.icao24, flight.firstSeen);
    
    return {
      flightNumber,
      coordinates: trackData.coordinates,
      callsign: trackData.callsign,
      departureAirport: flight.estDepartureAirport,
      arrivalAirport: flight.estArrivalAirport,
      path: trackData.finalPath
    };
    
  } catch (error) {
    console.error('Error getting flight path:', error);
    throw error;
  }
}

export function testingFlight() {
    let trackData = {
    "icao24": "a14ad1",
    "callsign": "UAL1729 ",
    "startTime": 1.754595881E9,
    "endTime": 1.754610565E9,
    "path": [
        [
            1754595881,
            26.0769,
            -80.1236,
            304,
            88,
            false
        ],
        [
            1754595924,
            26.0773,
            -80.08,
            304,
            89,
            false
        ],
        [
            1754595949,
            26.0775,
            -80.0497,
            609,
            89,
            false
        ],
        [
            1754595957,
            26.0774,
            -80.0392,
            914,
            91,
            false
        ],
        [
            1754595965,
            26.0771,
            -80.0289,
            914,
            94,
            false
        ],
        [
            1754595975,
            26.0752,
            -80.0159,
            1219,
            103,
            false
        ],
        [
            1754595983,
            26.0722,
            -80.0059,
            1219,
            111,
            false
        ],
        [
            1754595992,
            26.0673,
            -79.9947,
            1524,
            118,
            false
        ],
        [
            1754596000,
            26.0618,
            -79.9857,
            1524,
            128,
            false
        ],
        [
            1754596007,
            26.0552,
            -79.9783,
            1828,
            138,
            false
        ],
        [
            1754596016,
            26.0464,
            -79.9721,
            1828,
            153,
            false
        ],
        [
            1754596024,
            26.0353,
            -79.9681,
            2133,
            169,
            false
        ],
        [
            1754596033,
            26.0243,
            -79.9667,
            2133,
            174,
            false
        ],
        [
            1754596041,
            26.014,
            -79.9657,
            2438,
            175,
            false
        ],
        [
            1754596050,
            26.0018,
            -79.965,
            2438,
            180,
            false
        ],
        [
            1754596058,
            25.991,
            -79.9666,
            2743,
            193,
            false
        ],
        [
            1754596067,
            25.9793,
            -79.9716,
            2743,
            207,
            false
        ],
        [
            1754596075,
            25.9692,
            -79.9796,
            2743,
            221,
            false
        ],
        [
            1754596084,
            25.9608,
            -79.9882,
            3048,
            223,
            false
        ],
        [
            1754596092,
            25.9521,
            -79.9976,
            3048,
            224,
            false
        ],
        [
            1754596108,
            25.9352,
            -80.0159,
            3352,
            222,
            false
        ],
        [
            1754596116,
            25.9271,
            -80.0236,
            3352,
            220,
            false
        ],
        [
            1754596125,
            25.9163,
            -80.0323,
            3657,
            212,
            false
        ],
        [
            1754596133,
            25.9058,
            -80.0388,
            3657,
            206,
            false
        ],
        [
            1754596157,
            25.8733,
            -80.0572,
            3962,
            207,
            false
        ],
        [
            1754596183,
            25.8395,
            -80.0773,
            4267,
            208,
            false
        ],
        [
            1754596405,
            25.5184,
            -80.2704,
            4572,
            206,
            false
        ],
        [
            1754596413,
            25.5056,
            -80.2759,
            4572,
            197,
            false
        ],
        [
            1754596420,
            25.4932,
            -80.2787,
            4572,
            187,
            false
        ],
        [
            1754596429,
            25.4789,
            -80.279,
            4572,
            177,
            false
        ],
        [
            1754596491,
            25.3751,
            -80.2694,
            4572,
            175,
            false
        ],
        [
            1754596500,
            25.3598,
            -80.2695,
            4572,
            185,
            false
        ],
        [
            1754596508,
            25.3467,
            -80.2721,
            4572,
            193,
            false
        ],
        [
            1754596517,
            25.3323,
            -80.2769,
            4572,
            200,
            false
        ],
        [
            1754596525,
            25.3195,
            -80.2833,
            4572,
            206,
            false
        ],
        [
            1754596592,
            25.2155,
            -80.3448,
            4572,
            208,
            false
        ],
        [
            1754596618,
            25.1736,
            -80.3693,
            4876,
            208,
            false
        ],
        [
            1754596634,
            25.1501,
            -80.3831,
            5181,
            208,
            false
        ],
        [
            1754596651,
            25.1255,
            -80.3974,
            5486,
            207,
            false
        ],
        [
            1754596675,
            25.0909,
            -80.4176,
            5791,
            207,
            false
        ],
        [
            1754596683,
            25.0789,
            -80.4247,
            6096,
            208,
            false
        ],
        [
            1754596692,
            25.067,
            -80.4335,
            6096,
            219,
            false
        ],
        [
            1754596700,
            25.057,
            -80.4439,
            6096,
            226,
            false
        ],
        [
            1754596708,
            25.0484,
            -80.4553,
            6096,
            232,
            false
        ],
        [
            1754596716,
            25.0412,
            -80.4671,
            6400,
            239,
            false
        ],
        [
            1754596724,
            25.0348,
            -80.4801,
            6400,
            242,
            false
        ],
        [
            1754596740,
            25.0224,
            -80.5067,
            6400,
            243,
            false
        ],
        [
            1754596772,
            24.9981,
            -80.5596,
            6705,
            243,
            false
        ],
        [
            1754596814,
            24.9652,
            -80.6314,
            7010,
            243,
            false
        ],
        [
            1754596853,
            24.9326,
            -80.7,
            7315,
            242,
            false
        ],
        [
            1754596894,
            24.8999,
            -80.7708,
            7620,
            243,
            false
        ],
        [
            1754596900,
            24.8947,
            -80.7824,
            7620,
            245,
            false
        ],
        [
            1754596906,
            24.891,
            -80.7925,
            7620,
            248,
            false
        ],
        [
            1754596919,
            24.888,
            -80.8183,
            7924,
            270,
            false
        ],
        [
            1754596924,
            24.8893,
            -80.8291,
            7924,
            275,
            false
        ],
        [
            1754596935,
            24.8959,
            -80.8481,
            7924,
            296,
            false
        ],
        [
            1754596943,
            24.9043,
            -80.8611,
            7924,
            299,
            false
        ],
        [
            1754596949,
            24.9123,
            -80.8701,
            7924,
            313,
            false
        ],
        [
            1754596958,
            24.9236,
            -80.8828,
            7924,
            311,
            false
        ],
        [
            1754596967,
            24.9333,
            -80.8967,
            8229,
            303,
            false
        ],
        [
            1754596976,
            24.9419,
            -80.9121,
            8229,
            298,
            false
        ],
        [
            1754596984,
            24.9483,
            -80.9266,
            8229,
            294,
            false
        ],
        [
            1754597015,
            24.9708,
            -80.9841,
            8229,
            293,
            false
        ],
        [
            1754597059,
            25.0045,
            -81.0676,
            8534,
            293,
            false
        ],
        [
            1754597133,
            25.0615,
            -81.2078,
            8839,
            293,
            false
        ],
        [
            1754597198,
            25.1125,
            -81.3353,
            9144,
            293,
            false
        ],
        [
            1754597376,
            25.26,
            -81.7042,
            9448,
            293,
            false
        ],
        [
            1754597428,
            25.3053,
            -81.8183,
            9753,
            293,
            false
        ],
        [
            1754597485,
            25.3542,
            -81.9415,
            10058,
            293,
            false
        ],
        [
            1754597559,
            25.4178,
            -82.1019,
            10363,
            293,
            false
        ],
        [
            1754597656,
            25.5,
            -82.3112,
            10668,
            293,
            false
        ],
        [
            1754598174,
            25.9481,
            -83.4698,
            10972,
            292,
            false
        ],
        [
            1754598184,
            25.957,
            -83.4917,
            10972,
            295,
            false
        ],
        [
            1754598194,
            25.9677,
            -83.5144,
            10972,
            299,
            false
        ],
        [
            1754598202,
            25.9764,
            -83.5306,
            10972,
            301,
            false
        ],
        [
            1754599079,
            27.0041,
            -85.2902,
            10972,
            302,
            false
        ],
        [
            1754599406,
            27.3806,
            -85.9526,
            10972,
            302,
            false
        ],
        [
            1754599410,
            27.3852,
            -85.9609,
            10972,
            299,
            false
        ],
        [
            1754599423,
            27.3986,
            -85.9892,
            10972,
            293,
            false
        ],
        [
            1754599441,
            27.4127,
            -86.028,
            10972,
            291,
            false
        ],
        [
            1754599675,
            27.5946,
            -86.54,
            10972,
            293,
            false
        ],
        [
            1754599699,
            27.6197,
            -86.5906,
            10972,
            303,
            false
        ],
        [
            1754599846,
            27.7959,
            -86.8776,
            10972,
            304,
            false
        ],
        [
            1754599879,
            27.8383,
            -86.9411,
            10972,
            307,
            false
        ],
        [
            1754600171,
            28.2114,
            -87.4917,
            10972,
            309,
            false
        ],
        [
            1754600182,
            28.2264,
            -87.5105,
            10972,
            313,
            false
        ],
        [
            1754600295,
            28.3966,
            -87.7011,
            10972,
            315,
            false
        ],
        [
            1754600462,
            28.6483,
            -87.9762,
            10972,
            313,
            false
        ],
        [
            1754600636,
            28.8944,
            -88.2779,
            10972,
            311,
            false
        ],
        [
            1754600677,
            28.9508,
            -88.3523,
            10972,
            310,
            false
        ],
        [
            1754600687,
            28.9636,
            -88.3697,
            10972,
            308,
            false
        ],
        [
            1754600719,
            29.0053,
            -88.4305,
            10972,
            308,
            false
        ],
        [
            1754600728,
            29.0163,
            -88.4473,
            10972,
            304,
            false
        ],
        [
            1754600736,
            29.0252,
            -88.4629,
            10972,
            302,
            false
        ],
        [
            1754601634,
            30.0029,
            -90.2601,
            10972,
            301,
            false
        ],
        [
            1754602527,
            30.9605,
            -92.1005,
            10972,
            300,
            false
        ],
        [
            1754603421,
            31.9024,
            -94.0013,
            10972,
            299,
            false
        ],
        [
            1754604316,
            32.8014,
            -95.9096,
            10972,
            298,
            false
        ],
        [
            1754604912,
            33.3844,
            -97.2038,
            10972,
            297,
            false
        ],
        [
            1754604920,
            33.392,
            -97.2201,
            10972,
            301,
            false
        ],
        [
            1754604927,
            33.401,
            -97.2361,
            10972,
            306,
            false
        ],
        [
            1754604937,
            33.4131,
            -97.2542,
            10972,
            310,
            false
        ],
        [
            1754604945,
            33.4238,
            -97.2678,
            10972,
            314,
            false
        ],
        [
            1754604955,
            33.4387,
            -97.2842,
            10972,
            319,
            false
        ],
        [
            1754605851,
            34.8034,
            -98.7143,
            10972,
            318,
            false
        ],
        [
            1754606747,
            36.1548,
            -100.1937,
            10972,
            317,
            false
        ],
        [
            1754606848,
            36.2998,
            -100.3569,
            10972,
            317,
            false
        ],
        [
            1754606856,
            36.3103,
            -100.3681,
            10972,
            321,
            false
        ],
        [
            1754606863,
            36.3214,
            -100.378,
            10972,
            325,
            false
        ],
        [
            1754606867,
            36.328,
            -100.3829,
            10972,
            329,
            false
        ],
        [
            1754606875,
            36.3426,
            -100.3922,
            10972,
            335,
            false
        ],
        [
            1754606881,
            36.3531,
            -100.3974,
            10972,
            340,
            false
        ],
        [
            1754606891,
            36.3712,
            -100.4039,
            10972,
            346,
            false
        ],
        [
            1754606895,
            36.3788,
            -100.4058,
            10972,
            351,
            false
        ],
        [
            1754606905,
            36.3991,
            -100.4086,
            10972,
            354,
            false
        ],
        [
            1754606912,
            36.4131,
            -100.4086,
            10972,
            1,
            false
        ],
        [
            1754606917,
            36.423,
            -100.4077,
            10972,
            5,
            false
        ],
        [
            1754606926,
            36.4407,
            -100.4049,
            10972,
            5,
            false
        ],
        [
            1754606932,
            36.4519,
            -100.403,
            10972,
            8,
            false
        ],
        [
            1754607040,
            36.6641,
            -100.3644,
            10972,
            6,
            false
        ],
        [
            1754607049,
            36.6817,
            -100.3627,
            10972,
            1,
            false
        ],
        [
            1754607057,
            36.6987,
            -100.3631,
            10972,
            357,
            false
        ],
        [
            1754607063,
            36.7103,
            -100.3646,
            10972,
            352,
            false
        ],
        [
            1754607070,
            36.7234,
            -100.3675,
            10972,
            348,
            false
        ],
        [
            1754607077,
            36.7363,
            -100.3715,
            10972,
            344,
            false
        ],
        [
            1754607084,
            36.7503,
            -100.3774,
            10972,
            339,
            false
        ],
        [
            1754607091,
            36.7628,
            -100.3842,
            10972,
            335,
            false
        ],
        [
            1754607099,
            36.7762,
            -100.3932,
            10972,
            329,
            false
        ],
        [
            1754607106,
            36.7875,
            -100.4025,
            10972,
            324,
            false
        ],
        [
            1754607109,
            36.7923,
            -100.4069,
            10972,
            320,
            false
        ],
        [
            1754607121,
            36.809,
            -100.4253,
            10972,
            315,
            false
        ],
        [
            1754607127,
            36.817,
            -100.436,
            10972,
            310,
            false
        ],
        [
            1754607133,
            36.8239,
            -100.4468,
            10972,
            308,
            false
        ],
        [
            1754607133,
            36.8239,
            -100.4468,
            10972,
            303,
            false
        ],
        [
            1754607151,
            36.8417,
            -100.4839,
            10972,
            303,
            false
        ],
        [
            1754607160,
            36.8478,
            -100.5027,
            10972,
            288,
            false
        ],
        [
            1754607165,
            36.8508,
            -100.5153,
            10972,
            285,
            false
        ],
        [
            1754607184,
            36.8588,
            -100.5596,
            10972,
            285,
            false
        ],
        [
            1754607186,
            36.8599,
            -100.564,
            10972,
            294,
            false
        ],
        [
            1754607199,
            36.8715,
            -100.5926,
            10972,
            298,
            false
        ],
        [
            1754607199,
            36.8715,
            -100.5926,
            10972,
            304,
            false
        ],
        [
            1754607220,
            36.8964,
            -100.6317,
            10972,
            311,
            false
        ],
        [
            1754607222,
            36.8987,
            -100.6349,
            10972,
            309,
            false
        ],
        [
            1754608012,
            37.8325,
            -102.1339,
            10972,
            310,
            false
        ],
        [
            1754608019,
            37.8421,
            -102.1465,
            10972,
            314,
            false
        ],
        [
            1754608025,
            37.8512,
            -102.1565,
            10972,
            320,
            false
        ],
        [
            1754608033,
            37.8637,
            -102.1681,
            10972,
            325,
            false
        ],
        [
            1754608040,
            37.8756,
            -102.177,
            10972,
            331,
            false
        ],
        [
            1754608047,
            37.888,
            -102.1846,
            10972,
            336,
            false
        ],
        [
            1754608054,
            37.9013,
            -102.1911,
            10972,
            340,
            false
        ],
        [
            1754608061,
            37.9144,
            -102.1958,
            10972,
            345,
            false
        ],
        [
            1754608067,
            37.927,
            -102.199,
            10668,
            350,
            false
        ],
        [
            1754608073,
            37.9384,
            -102.2009,
            10668,
            354,
            false
        ],
        [
            1754608081,
            37.9543,
            -102.202,
            10668,
            358,
            false
        ],
        [
            1754608126,
            38.0467,
            -102.2028,
            10668,
            359,
            false
        ],
        [
            1754608134,
            38.0618,
            -102.2028,
            10363,
            0,
            false
        ],
        [
            1754608191,
            38.1808,
            -102.2002,
            10363,
            1,
            false
        ],
        [
            1754608203,
            38.2043,
            -102.1995,
            10058,
            0,
            false
        ],
        [
            1754608213,
            38.2254,
            -102.2005,
            10058,
            355,
            false
        ],
        [
            1754608220,
            38.2392,
            -102.2038,
            10058,
            346,
            false
        ],
        [
            1754608227,
            38.2528,
            -102.2103,
            10058,
            336,
            false
        ],
        [
            1754608237,
            38.2685,
            -102.2226,
            10058,
            325,
            false
        ],
        [
            1754608246,
            38.282,
            -102.2393,
            10058,
            310,
            false
        ],
        [
            1754608254,
            38.2912,
            -102.2555,
            10058,
            302,
            false
        ],
        [
            1754608263,
            38.299,
            -102.274,
            9753,
            295,
            false
        ],
        [
            1754608280,
            38.3132,
            -102.311,
            9753,
            297,
            false
        ],
        [
            1754608304,
            38.3356,
            -102.3634,
            9753,
            298,
            false
        ],
        [
            1754608312,
            38.3441,
            -102.3821,
            9753,
            301,
            false
        ],
        [
            1754608322,
            38.3541,
            -102.4023,
            9448,
            302,
            false
        ],
        [
            1754608548,
            38.5933,
            -102.8679,
            9753,
            302,
            false
        ],
        [
            1754608614,
            38.6628,
            -103.0046,
            9448,
            302,
            false
        ],
        [
            1754608664,
            38.7152,
            -103.1083,
            9144,
            302,
            false
        ],
        [
            1754608693,
            38.7448,
            -103.1671,
            8839,
            302,
            false
        ],
        [
            1754608722,
            38.7744,
            -103.2261,
            8534,
            302,
            false
        ],
        [
            1754608750,
            38.8025,
            -103.2816,
            8229,
            302,
            false
        ],
        [
            1754608778,
            38.8299,
            -103.336,
            7924,
            302,
            false
        ],
        [
            1754608811,
            38.8616,
            -103.3989,
            7620,
            302,
            false
        ],
        [
            1754608872,
            38.914,
            -103.5046,
            7315,
            302,
            false
        ],
        [
            1754608932,
            38.9646,
            -103.606,
            7010,
            302,
            false
        ],
        [
            1754608993,
            39.0148,
            -103.707,
            6705,
            302,
            false
        ],
        [
            1754609053,
            39.0641,
            -103.8068,
            6400,
            302,
            false
        ],
        [
            1754609115,
            39.1148,
            -103.9094,
            6096,
            302,
            false
        ],
        [
            1754609121,
            39.1197,
            -103.919,
            5791,
            303,
            false
        ],
        [
            1754609128,
            39.1259,
            -103.9304,
            5791,
            306,
            false
        ],
        [
            1754609134,
            39.1315,
            -103.9393,
            5791,
            309,
            false
        ],
        [
            1754609181,
            39.1798,
            -104.0098,
            5791,
            311,
            false
        ],
        [
            1754609241,
            39.2409,
            -104.0987,
            5486,
            311,
            false
        ],
        [
            1754609280,
            39.2817,
            -104.1582,
            5181,
            311,
            false
        ],
        [
            1754609287,
            39.2886,
            -104.1685,
            4876,
            310,
            false
        ],
        [
            1754609294,
            39.2949,
            -104.1799,
            4876,
            302,
            false
        ],
        [
            1754609300,
            39.299,
            -104.1896,
            4876,
            296,
            false
        ],
        [
            1754609307,
            39.3031,
            -104.2026,
            4876,
            289,
            false
        ],
        [
            1754609314,
            39.3058,
            -104.2149,
            4876,
            283,
            false
        ],
        [
            1754609353,
            39.3179,
            -104.2886,
            4572,
            281,
            false
        ],
        [
            1754609392,
            39.3293,
            -104.3602,
            4267,
            281,
            false
        ],
        [
            1754609433,
            39.3411,
            -104.4348,
            3962,
            281,
            false
        ],
        [
            1754609439,
            39.343,
            -104.4453,
            3962,
            284,
            false
        ],
        [
            1754609446,
            39.3465,
            -104.4568,
            3962,
            296,
            false
        ],
        [
            1754609453,
            39.3516,
            -104.4686,
            3962,
            300,
            false
        ],
        [
            1754609531,
            39.405,
            -104.582,
            3657,
            301,
            false
        ],
        [
            1754609538,
            39.4105,
            -104.5915,
            3657,
            311,
            false
        ],
        [
            1754609545,
            39.4175,
            -104.5992,
            3352,
            324,
            false
        ],
        [
            1754609551,
            39.4242,
            -104.6042,
            3352,
            331,
            false
        ],
        [
            1754609557,
            39.4309,
            -104.6085,
            3352,
            334,
            false
        ],
        [
            1754609583,
            39.4623,
            -104.6268,
            3352,
            335,
            false
        ],
        [
            1754609615,
            39.4996,
            -104.6503,
            3048,
            332,
            false
        ],
        [
            1754609622,
            39.5075,
            -104.6556,
            3048,
            332,
            false
        ],
        [
            1754609628,
            39.5142,
            -104.6597,
            3048,
            337,
            false
        ],
        [
            1754609635,
            39.5228,
            -104.6628,
            3048,
            347,
            false
        ],
        [
            1754609641,
            39.5303,
            -104.6641,
            2743,
            355,
            false
        ],
        [
            1754609648,
            39.5397,
            -104.6644,
            2743,
            0,
            false
        ],
        [
            1754609681,
            39.5816,
            -104.6631,
            2743,
            0,
            false
        ],
        [
            1754609707,
            39.6167,
            -104.6631,
            2743,
            0,
            false
        ],
        [
            1754609756,
            39.6744,
            -104.6624,
            2438,
            0,
            false
        ],
        [
            1754609800,
            39.7185,
            -104.6618,
            2133,
            0,
            false
        ],
        [
            1754609816,
            39.7328,
            -104.6618,
            2133,
            0,
            false
        ],
        [
            1754609883,
            39.788,
            -104.661,
            1828,
            0,
            false
        ],
        [
            1754609924,
            39.821,
            -104.6606,
            1524,
            0,
            false
        ],
        [
            1754609952,
            39.8415,
            -104.6604,
            1524,
            0,
            false
        ],
        [
            1754610565,
            39.8596,
            -104.6671,
            304,
            182,
            false
        ]
    ]
}
    const coordinates = trackData.path
      .filter(point => point[1] !== null && point[2] !== null) // Filter out null coordinates
      .map(point => [point[1], point[2]]); // [lat, lon]
    
    return {
      coordinates,
      callsign: trackData.callsign,
      path: trackData.path,
      flightnumber: "a84e0c",
      departureAirport: "KSEA",
      arrivalAirport: "17OR"
    };
}